@using Microsoft.AspNetCore.Identity
@using sbpc.Timesheet.Data.Entity
@inject UserManager<ApplicationUser> UserManager
@{
    ViewData["Title"] = "Timesheet Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div id="wait" class="modal" style="display:none; position:absolute; top:50%; left:50%;"><img src='~/images/pIkfp.gif'/></div>
<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">
            @ViewData["Title"]
        </h1>
    </div>
</div>
<div id="TimesheetWidget">
    @await Component.InvokeAsync("TimesheetWidget", new { userName = UserManager.GetUserName(User), dateTime = ViewBag.date == null ? DateTime.Now : ViewBag.date })
</div>


@section scripts
    {
    <script type="text/javascript">
        $(function () {

            $(document).on("change", 'input[type="date"]', function () {
                event.preventDefault();
                $("#wait").modal("show");
                $.get('/Timesheet/GetDate/?date=' + $(this).val(), function (data) {
                    $("#TimesheetWidget").html(data);
                    $("#wait").modal("hide");
                });
            });

            //handle crud on hours
            $(document).on("submit","form.hour", function () {
                event.preventDefault();
                $("#wait").modal("show");
                $.post('@Url.Action("SaveHour","Timesheet")', $(this).serialize(), function (data) {
                    $("form.hour")[0].reset();
                    $("#TimesheetWidget").html(data);
                    $("#wait").modal("hide");
                });
            });

            $(document).on("click", ".edit-hour", function () {
                event.preventDefault();
                $.get('/Timesheet/EditHour/?Id='+ $(this).data("hour"), function (data) {
                    $("#HourWidget").html(data);
                });
            });

            $(document).on("click", ".delete-hour", function () {
                event.preventDefault();
                $("#wait").modal("show");
                $.post('@Url.Action("DeleteHour","Timesheet")', { Id: $(this).data("hour"), date: $(this).data("date") }, function (data) {
                    $("form.hour")[0].reset();
                    $("#TimesheetWidget").html(data);
                    $("#wait").modal("hide");
                });
            });

            //handle crud operation on expense
             $(document).on("submit","form.expense", function () {
                event.preventDefault();
                $("#wait").modal("show");
                $.post('@Url.Action("SaveExpense","Timesheet")', $(this).serialize(), function (data) {
                    $("form.expense")[0].reset();
                    $("#TimesheetWidget").html(data);
                    $('.nav-tabs a[href="#expense"]').tab('show');
                    $("#wait").modal("hide");
                });
            });

             $(document).on("click", ".edit-expense", function () {
                event.preventDefault();
                $.get('/Timesheet/EditExpense/?Id='+ $(this).data("expense"), function (data) {
                    $("#ExpenseWidget").html(data);
                });
            });

             $(document).on("click", ".delete-expense", function () {
                event.preventDefault();
                $("#wait").modal("show")
                $.post('@Url.Action("DeleteExpense","Timesheet")', { Id: $(this).data("expense"), date: $(this).data("date") }, function (data) {
                    $("form.expense")[0].reset();
                    $("#TimesheetWidget").html(data);
                    $('.nav-tabs a[href="#expense"]').tab('show');
                    $("#wait").modal("hide");
                });
             });

            //handle crud operations on mileage
            $(document).on("submit","form.mileage", function () {
                event.preventDefault();
                $("#wait").modal("show");
                $.post('@Url.Action("SaveMileage","Timesheet")', $(this).serialize(), function (data) {
                    $("form.mileage")[0].reset();
                    $("#TimesheetWidget").html(data);
                    $('.nav-tabs a[href="#mileage"]').tab('show');
                    $("#wait").modal("hide");
                });
            });

            $(document).on("click", ".edit-mileage", function () {
                event.preventDefault();
                $.get('/Timesheet/EditMileage/?Id='+ $(this).data("mileage"), function (data) {
                    $("#MileageWidget").html(data);
                });
            });

             $(document).on("click", ".delete-mileage", function () {
                event.preventDefault();
                $("#wait").modal("show")
                $.post('@Url.Action("DeleteMileage","Timesheet")', { Id: $(this).data("mileage"), date: $(this).data("date") }, function (data) {
                    $("form.mileage")[0].reset();
                    $("#TimesheetWidget").html(data);
                    $('.nav-tabs a[href="#mileage"]').tab('show');
                    $("#wait").modal("hide");
                });
             });
        });
    </script>
}
